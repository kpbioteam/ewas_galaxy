<tool id="minfi_read450k" name="Minfi Read 450k" version="2.1.0">
    <description>load .IDAT files</description>
    <requirements>
        <requirement type="package" version="1.24.0">bioconductor-minfi</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[

import os

# detect the current working directory
path = os.getcwd($files_red)

# read the entries
with os.scandir(path) as listOfEntries:  
    for entry in listOfEntries:
        # print all entries that are files
        if entry.is_file():
            print(entry.name)

      cat '$read_idat_script' &&
      Rscript '$read_idat_script'
      ]]></command>
      <configfiles>
      <configfile name="read_idat_script"><![CDATA[
        require("minfi", quietly = TRUE)

        out <- read.metharray(entry.name)

        save(out, file = '$RGChannelSet')
        ]]> </configfile>
        </configfiles>
        <inputs>
        <param type="data" name="files_red" multiple="true" format="idat" label="Red .IDAT files"/>
        <param type="data" name="files_grn" multiple="true" format="idat" label="Green .IDAT files" />
            </inputs>
            <outputs>
            <data name="RGChannelSet" format="rdata" label="RGChannelSet"/>
              </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="format" value="files" />
            <repeat name="rep_factor">
                <param name="factorName" value="Sensitivity"/>
                <repeat name="rep_group">
                    <param name="groupName" value="sensitive"/>
                    <param name="idatsFile" value="GSM1588704_8795207135_R01C02_Red.idat, GSM1588704_8795207135_R01C02_Grn.idat
                    GSM1588705_8795207119_R05C02_Red.idat, GSM1588705_8795207119_R05C02_Grn.idat"/>
                </repeat>
                <repeat name="rep_group">
                    <param name="groupName" value="resistant"/>
                    <param name="idatsFile" value="GSM1588706_8795207135_R02C02_Red.idat, GSM1588706_8795207135_R02C02_Grn.idat
                    GSM1588707_8795207119_R06C02_Red.idat, GSM1588707_8795207119_R06C02_Grn.idat"/>
                </repeat>
            </repeat>
            <repeat name="rep_factor">
                <param name="factorName" value="Treatment"/>
                <repeat name="rep_group">
                    <param name="groupName" value="MAPKi"/>
                    <param name="idatsFile" value="GSM1588704_8795207135_R01C02_Red.idat, GSM1588704_8795207135_R01C02_Grn.idat
                    GSM1588705_8795207119_R05C02_Red.idat, GSM1588705_8795207119_R05C02_Grn.idat"/>
                </repeat>
                <repeat name="rep_group">
                    <param name="groupName" value="BRAFi"/>
                    <param name="idatsFile" value="GSM1588706_8795207135_R02C02_Red.idat, GSM1588706_8795207135_R02C02_Grn.idat
                    GSM1588707_8795207119_R06C02_Red.idat, GSM1588707_8795207119_R06C02_Grn.idat"/>
                </repeat>
            <output name="RGChannelSet" file="RGChannelSet.rdata"/>
            </output>
        </test>
        
        </test>
    </tests>

    <help><![CDATA[
.. class:: infomark

**What it does**

The tool load the binary 450K array “IDAT” raw files generated by the Illumina Scanner. In addition to the methylated and an unmethylated intensity values for each 450,000 CpG positions, IDAT file contains some extra info such as control probes.

-----

**Input Data:**
The counts data can either be input as separate counts files (one sample per file) or a single count matrix (one sample per column). The rows correspond to genes, and columns correspond to the counts for the samples. Values must be tab separated, with the first row containing the sample/column labels and the first column containing the row/gene labels. The sample labels must start with a letter. Gene identifiers can be of any type but must be unique and not repeated within a counts file.

Example - **Separate Idats Files**:

GSM1588707_8795207119_R06C02_Red.idat,GSM1588706_8795207135_R02C02_Red.idat,GSM1588705_8795207119_R05C02_Red.idat,GSM1588704_8795207135_R01C02_Red.idat

Example - **Single Idat Matrix**:

    ========================= ====================== ======================== 
          **File Name**          **Sensitivity**          **Treatment** 
    ------------------------- ---------------------- ------------------------ 

    ========================= ====================== ======================== 

    ]]></help>
    <citations>
         <citation type="doi">10.18129/B9.bioc.illuminaio</citation>
    </citations>
</tool>
